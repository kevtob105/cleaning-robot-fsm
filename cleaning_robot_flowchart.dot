digraph CleaningRobotFSM {
    rankdir=LR;
    node [shape=box, style="rounded,filled", fontname="Arial", fontsize=11];
    
    // Define states
    STATE_IDLE [fillcolor=lightgray, label="IDLE\n\nWaiting\nBattery check"];
    STATE_CLEANING [fillcolor=lightgreen, label="CLEANING\n\nRandom movement\nObstacle avoidance"];
    STATE_SPOT [fillcolor=yellow, label="SPOT\nCLEANING\n\nSpiral pattern\nIntensive"];
    STATE_EDGE [fillcolor=orange, label="EDGE\nCLEANING\n\nWall following\nPerimeter"];
    STATE_STUCK [fillcolor=red, fontcolor=white, label="STUCK\n\nReverse\nTurn\nRecovery"];
    STATE_DOCKING [fillcolor=lightblue, label="DOCKING\n\nFind dock\nNavigate"];
    STATE_CHARGING [fillcolor=cyan, label="CHARGING\n\nRecharge\nMonitor"];
    
    // State transitions
    STATE_IDLE -> STATE_CLEANING [label="Start\n(Battery>20%)"];
    
    STATE_CLEANING -> STATE_SPOT [label="Dirty spot\n(2%)"];
    STATE_CLEANING -> STATE_EDGE [label="Wall\n(5%)"];
    STATE_CLEANING -> STATE_STUCK [label="No move\n(3s)"];
    STATE_CLEANING -> STATE_DOCKING [label="Low battery\n(<20%)"];
    STATE_CLEANING -> STATE_CLEANING [label="Continue"];
    
    STATE_SPOT -> STATE_CLEANING [label="Done\n(8s)"];
    STATE_EDGE -> STATE_CLEANING [label="Lost wall\n(12s)"];
    STATE_STUCK -> STATE_CLEANING [label="Recovered\n(3s)"];
    
    STATE_DOCKING -> STATE_CHARGING [label="Docked\n(d<0.15m)"];
    STATE_CHARGING -> STATE_IDLE [label="Full\n(â‰¥95%)"];
    
    // Legend
    subgraph cluster_legend {
        label="State Types";
        style=dashed;
        fontsize=10;
        
        leg1 [shape=box, fillcolor=lightgreen, label="Active"];
        leg2 [shape=box, fillcolor=yellow, label="Special"];
        leg3 [shape=box, fillcolor=red, fontcolor=white, label="Error"];
        leg4 [shape=box, fillcolor=lightblue, label="Navigate"];
        leg5 [shape=box, fillcolor=cyan, label="Maintain"];
        
        leg1 -> leg2 [style=invis];
        leg2 -> leg3 [style=invis];
        leg3 -> leg4 [style=invis];
        leg4 -> leg5 [style=invis];
    }
}
